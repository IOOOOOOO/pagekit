!function(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(s,n,function(t){return e[t]}.bind(null,n));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=12)}({12:function(e,t){e.exports={name:"widgets",el:"#widgets",mixins:[window.Widgets],data(){return _.merge({position:this.$session.get("widget.position"),selected:[],config:{positions:[],filter:this.$session.get("widget.filter",{})},unassignedWidgets:[],type:{}},window.$data)},mounted(){this.load()},computed:{filtered_positions(){return _.filter(this.positions,e=>this.position?this.active(e):"_unassigned"!=e.name?e.widgets.length:0)},positions(){return this.config.positions.concat(this.unassigned)},unassigned(){return{name:"_unassigned",label:this.$trans("Unassigned"),assigned:_.map(this.unassignedWidgets,"id"),widgets:this.unassignedWidgets}},empty(){return!this.position&&!this.get("assigned").length},nodes(){const e=[],t=_(this.config.nodes).groupBy("menu").value();return _.forEach(this.config.menus,(i,s)=>{const n=t[s];n&&e.push({label:i.label,options:_.map(n,e=>({text:e.title,value:e.id}))})},this),e}},methods:{get(e){const t={selected(e){return-1!==this.selected.indexOf(e.id)},assigned(e){return this.positions.some(t=>-1!==t.assigned.indexOf(e.id))},unassigned(e){return!this.positions.some(t=>-1!==t.assigned.indexOf(e.id))}};return t[e]?this.widgets.filter(t[e],this):this.widgets},load(){return this.resource.query().then(function(e){this.config.positions=e.data.positions,this.unassignedWidgets=e.data.unassigned})},active(e){return this.position===e||e&&this.position&&this.position.name==e.name},select(e){e&&this.$set(this,"selected",[]),this.$set(this,"position",e),e?this.$session.set("widget.position",e):this.$session.remove("widget.position")},assign(e,t){return this.resource.save({id:"assign"},{position:e,ids:t}).then(function(){this.load(),this.$set(this,"selected",[])})},move(e,t){e=_.find(this.positions,{name:e}),this.assign(e.name,e.assigned.concat(t)).then(function(){this.$notify(this.$transChoice("{1} %count% Widget moved|]1,Inf[ %count% Widgets moved",t.length,{count:t.length}))})},copy(){this.resource.save({id:"copy"},{ids:this.selected}).then(function(e){this.load().then(),this.$set(this,"selected",[]),this.$notify("Widget(s) copied.")})},remove(){this.resource.delete({id:"bulk"},{ids:this.selected}).then(function(){this.load(),this.$notify("Widget(s) removed."),this.$set(this,"selected",[])})},status(e){const t=this.get("selected");t.forEach(t=>{t.status=e}),this.resource.save({id:"bulk"},{widgets:t}).then(function(){this.load(),this.$set(this,"selected",[]),this.$notify("Widget(s) saved.")})},toggleStatus(e){e.status=e.status?0:1,this.resource.save({id:e.id},{widget:e}).then(function(){this.load(),this.$notify("Widget saved.")})},infilter(e){return this.config.filter.search?-1!=e.title.toLowerCase().indexOf(this.config.filter.search.toLowerCase()):!this.config.filter.node||!e.nodes.length||e.nodes.some(function(e){return e===this.config.filter.node},this)},emptyafterfilter(e){return!(e=e||this.config.positions.reduce((e,t)=>e.concat(t.widgets),[])).some(function(e){return this.infilter(e)},this)},getPageFilter(e){return e.nodes.length?e.nodes.length>1?this.$trans("Selected"):(_.find(this.config.nodes,"id",e.nodes[0])||{}).title:this.$trans("All")},isSelected(e){return-1!==this.selected.indexOf(e)},typeExist(e){const t=_.find(window.$data.types,{name:e.type});if(t)return t.label||t.name}},watch:{"config.filter":{handler(e){this.$session.set("widget.filter",e)},deep:!0}},filters:{show(e){return this.position?this.active(e):"_unassigned"!=e.name?e.widgets.length:0},type(e){const t=_.find(window.$data.types,{name:e.type});if(t)return t.label||t.name},assigned(e){return e.map(function(e){return _.find(this.widgets,"id",e)},this).filter(e=>void 0!==e)}},directives:{sortable:{params:["group"],bind(e,t,i){"_unassigned"!=e.getAttribute("data-position")&&(t.handler=function(s,n,o){const r=s.type;"added"!=r&&"moved"!=r||i.context.assign(UIkit.util.data(e,"position"),_.map(t.def.serialize(e,t,i),"id")),"removed"==r&&(n.$el.children.length||(console.log("!!!"),o.remove()))},Vue.nextTick(()=>{const i=UIkit.sortable(e,{group:"position"});t.sortable=i.$el,UIkit.util.on(i.$el,"added moved removed",t.handler)}))},unbind(e,t,i){UIkit.util.off(t.sortable,"added moved removed",t.handler)},serialize(e,t,i){const s=[];let n,o;const r=this;return UIkit.util.toNodes(e.children).forEach((e,t)=>{n={};for(var i,d,a=0;a<e.attributes.length;a++)0===(o=e.attributes[a]).name.indexOf("data-")&&(i=o.name.substr(5),d=r.str2json(o.value),n[i]=d||"false"==o.value||"0"==o.value?d:o.value);s.push(n)}),s},str2json(e,t){try{return t?JSON.parse(e.replace(/([\$\w]+)\s*:/g,(e,t)=>`"${t}":`).replace(/'([^']+)'/g,(e,t)=>`"${t}"`)):new Function("",`var json = ${e}; return JSON.parse(JSON.stringify(json));`)()}catch(e){return!1}}}}},Vue.ready(e.exports)}});