!function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=12)}({12:function(t,e){t.exports={name:"widgets",el:"#widgets",mixins:[window.Widgets,Theme.Mixins.Helper],data:function(){return _.merge({position:this.$session.get("widget.position"),selected:[],config:{positions:[],filter:this.$session.get("widget.filter",{})},unassignedWidgets:[],type:{}},window.$data)},theme:{hiddenHtmlElements:[".pk-width-content > div:first-child"],elements:function(){var t=this;return{title:{scope:"breadcrumbs",type:"caption",caption:function(){return t.position?t.position.label:t.$trans("All")}},addwidget:{scope:"topmenu-left",type:"dropdown",caption:"Add",class:"uk-button uk-button-text",icon:{attrs:{"uk-icon":"triangle-down"}},dropdown:{options:function(){return"mode: click"}},items:function(){return Object.values(t.types).map(function(e){var n={caption:e.label||e.name,attrs:{href:function(){return t.$url.route("admin/site/widget/edit",{type:e.name,position:t.position?t.position.name:""})}}};return Object.assign({},e,n)})},priority:0},search:{scope:"navbar-right",type:"search",class:"uk-text-small",domProps:{value:function(){return t.config.filter.search||""}},on:{input:function(e){!t.config.filter.search&&t.$set(t.config.filter,"search",""),t.config.filter.search=e.target.value}}},actions:{scope:"topmenu-left",type:"dropdown",caption:"Actions",class:"uk-button uk-button-text",icon:{attrs:{"uk-icon":"triangle-down"}},dropdown:{options:function(){return"mode:click"}},actionIcons:!0,items:function(){return{publish:{on:{click:function(){return t.status(1)}}},unpublish:{on:{click:function(){return t.status(0)}}},copy:{on:{click:function(){return t.copy}}},move:{type:"dropdown",dropdown:{options:function(){return"pos: right-top; delayHide: 0; offset: 25"}},items:function(){return t.config.positions.map(function(e){var n={caption:e.label,on:{click:function(){return t.move(e.name,t.selected)}}};return Object.assign({},e,n)})}},trash:{on:{click:function(){return t.remove}}}}},priority:2,disabled:function(){return!t.selected.length}},selected:{scope:"topmenu-right",type:"caption",caption:function(){return t.$transChoice("{1} %count% Widget selected|]1,Inf[ %count% Widgets selected",t.selected.length,{count:t.selected.length})},class:"uk-text-small",vif:!t.selected.length}}}},mounted:function(){this.load()},computed:{filtered_positions:function(){var t=this;return _.filter(this.positions,function(e){return t.position?t.active(e):"_unassigned"!=e.name?e.widgets.length:0})},positions:function(){return this.config.positions.concat(this.unassigned)},unassigned:function(){return{name:"_unassigned",label:this.$trans("Unassigned"),assigned:_.map(this.unassignedWidgets,"id"),widgets:this.unassignedWidgets}},empty:function(){return!this.position&&!this.get("assigned").length},nodes:function(){var t=[],e=_(this.config.nodes).groupBy("menu").value();return _.forEach(this.config.menus,function(n,i){var s=e[i];s&&t.push({label:n.label,options:_.map(s,function(t){return{text:t.title,value:t.id}})})},this),t}},methods:{get:function(t){var e={selected:function(t){return-1!==this.selected.indexOf(t.id)},assigned:function(t){return this.positions.some(function(e){return-1!==e.assigned.indexOf(t.id)})},unassigned:function(t){return!this.positions.some(function(e){return-1!==e.assigned.indexOf(t.id)})}};return e[t]?this.widgets.filter(e[t],this):this.widgets},load:function(){return this.resource.query().then(function(t){this.config.positions=t.data.positions,this.unassignedWidgets=t.data.unassigned})},active:function(t){return this.position===t||t&&this.position&&this.position.name==t.name},select:function(t){t&&this.$set(this,"selected",[]),this.$set(this,"position",t),t?this.$session.set("widget.position",t):this.$session.remove("widget.position")},assign:function(t,e){return this.resource.save({id:"assign"},{position:t,ids:e}).then(function(){this.load(),this.$set(this,"selected",[])})},move:function(t,e){t=_.find(this.positions,{name:t}),this.assign(t.name,t.assigned.concat(e)).then(function(){this.$notify(this.$transChoice("{1} %count% Widget moved|]1,Inf[ %count% Widgets moved",e.length,{count:e.length}))})},copy:function(){this.resource.save({id:"copy"},{ids:this.selected}).then(function(t){this.load().then(),this.$set(this,"selected",[]),this.$notify("Widget(s) copied.")})},remove:function(){this.resource.delete({id:"bulk"},{ids:this.selected}).then(function(){this.load(),this.$notify("Widget(s) removed."),this.$set(this,"selected",[])})},status:function(t){var e=this.get("selected");e.forEach(function(e){e.status=t}),this.resource.save({id:"bulk"},{widgets:e}).then(function(){this.load(),this.$set(this,"selected",[]),this.$notify("Widget(s) saved.")})},toggleStatus:function(t){t.status=t.status?0:1,this.resource.save({id:t.id},{widget:t}).then(function(){this.load(),this.$notify("Widget saved.")})},infilter:function(t){return this.config.filter.search?-1!=t.title.toLowerCase().indexOf(this.config.filter.search.toLowerCase()):!this.config.filter.node||!t.nodes.length||t.nodes.some(function(t){return t===this.config.filter.node},this)},emptyafterfilter:function(t){return!(t=t||this.config.positions.reduce(function(t,e){return t.concat(e.widgets)},[])).some(function(t){return this.infilter(t)},this)},getPageFilter:function(t){return t.nodes.length?t.nodes.length>1?this.$trans("Selected"):(_.find(this.config.nodes,"id",t.nodes[0])||{}).title:this.$trans("All")},isSelected:function(t){return-1!==this.selected.indexOf(t)},typeExist:function(t){var e=_.find(window.$data.types,{name:t.type});if(e)return e.label||e.name}},watch:{"config.filter":{handler:function(t){this.$session.set("widget.filter",t)},deep:!0}},filters:{show:function(t){return this.position?this.active(t):"_unassigned"!=t.name?t.widgets.length:0},type:function(t){var e=_.find(window.$data.types,{name:t.type});if(e)return e.label||e.name},assigned:function(t){return t.map(function(t){return _.find(this.widgets,"id",t)},this).filter(function(t){return void 0!==t})}},directives:{sortable:{params:["group"],bind:function(t,e,n){"_unassigned"!=t.getAttribute("data-position")&&(e.handler=function(i,s,o){var r=i.type;"added"!=r&&"moved"!=r||n.context.assign(UIkit.util.data(t,"position"),_.map(e.def.serialize(t,e,n),"id")),"removed"==r&&(s.$el.children.length||(console.log("!!!"),o.remove()))},Vue.nextTick(function(){var n=UIkit.sortable(t,{group:"position"});e.sortable=n.$el,UIkit.util.on(n.$el,"added moved removed",e.handler)}))},unbind:function(t,e,n){UIkit.util.off(e.sortable,"added moved removed",e.handler)},serialize:function(t,e,n){var i,s,o=[],r=this;return UIkit.util.toNodes(t.children).forEach(function(t,e){i={};for(var n,u,c=0;c<t.attributes.length;c++)0===(s=t.attributes[c]).name.indexOf("data-")&&(n=s.name.substr(5),u=r.str2json(s.value),i[n]=u||"false"==s.value||"0"==s.value?u:s.value);o.push(i)}),o},str2json:function(t,e){try{return e?JSON.parse(t.replace(/([\$\w]+)\s*:/g,function(t,e){return'"'.concat(e,'":')}).replace(/'([^']+)'/g,function(t,e){return'"'.concat(e,'"')})):new Function("","var json = ".concat(t,"; return JSON.parse(JSON.stringify(json));"))()}catch(t){return!1}}}}},Vue.ready(t.exports)}});